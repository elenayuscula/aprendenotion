---
import LessonLayout from '../layouts/LessonLayout.astro';

const toc = [
  { label: 'Requisitos previos', href: '#requisitos' },
  { label: 'if()', href: '#if' },
  { label: 'slice()', href: '#slice' },
  { label: 'round()', href: '#round' },
  { label: 'format()', href: '#format' },
  { label: 'Caracteres para la barra', href: '#caracteres' },
  { label: 'Construcci√≥n de la f√≥rmula completa', href: '#formula-completa' },
  { label: 'Desglose de la f√≥rmula', href: '#desglose' },
];
---

<LessonLayout
  title="5.04. Bola extra: Barras de progreso en Notion ‚Äî Aprende Notion"
  description="Aprende a crear barras de progreso visuales en Notion usando f√≥rmulas con if(), slice(), round() y format()."
  emoji="‚ûó"
  lessonTitle="5.04. Bola extra: C√≥mo crear barras de progreso en Notion"
  prevLink={{ href: '/input-values', label: '5.03. Bola extra: Tipos de valores' }}
  nextLink={{ href: '/api-notion', label: 'üîå 6. La API de Notion' }}
  toc={toc}
>
  <div class="video-embed">
    <iframe src="https://www.youtube.com/embed/gNcAJhuLrZU" title="C√≥mo crear barras de progreso en Notion" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
  </div>

  <h2 id="requisitos">Requisitos previos</h2>
  <p>Para crear barras de progreso en Notion necesitas:</p>
  <ol>
    <li><strong>M√≠nimo dos bases de datos relacionadas</strong> entre s√≠. Usar√°s esta relaci√≥n para extraer el porcentaje de tareas asociadas a un proyecto que est√©n completadas.</li>
    <li><strong>Cuatro funciones diferentes:</strong>
      <ul>
        <li><code>if()</code> como condicional</li>
        <li><code>slice()</code> para pintar la barra</li>
        <li><code>round()</code> para redondear cifras</li>
        <li><code>format()</code> para convertir n√∫meros a texto</li>
      </ul>
    </li>
  </ol>

  <h2 id="if">if()</h2>
  <p>Esta funci√≥n comprueba si se cumple una condici√≥n concreta. Necesita tres argumentos:</p>
  <ol>
    <li>Una expresi√≥n que eval√∫a si un valor es cierto (<code>true</code>) o falso (<code>false</code>)</li>
    <li>El valor a devolver si el resultado es <code>true</code></li>
    <li>El valor a devolver si el resultado es <code>false</code></li>
  </ol>
  <p><strong>Sintaxis:</strong> <code>[comparaci√≥n] ? [qu√© ocurre si es true] : [qu√© ocurre si es false]</code></p>

  <h2 id="slice">slice()</h2>
  <p>Devuelve el segmento de un string que le indiques. Toma tres argumentos:</p>
  <ol>
    <li>El string original</li>
    <li>El punto de origen (siendo el primer car√°cter 0)</li>
    <li>El punto final (opcional)</li>
  </ol>
  <p><strong>Ejemplo:</strong> <code>slice("manzana, pera, sand√≠a, kiwi", 9, 21)</code> ‚Üí <code>pera, sand√≠a</code></p>
  <p>Se utilizar√° doblemente en la f√≥rmula: para pintar la barra rellena seg√∫n el porcentaje completado y para a√±adir la parte vac√≠a.</p>

  <h2 id="round">round()</h2>
  <p>Redondea un n√∫mero decimal a su entero m√°s cercano.</p>
  <p><strong>Ejemplo:</strong> <code>round(1.3)</code> ‚Üí <code>1</code></p>

  <h2 id="format">format()</h2>
  <p>Convierte un n√∫mero en texto (string).</p>
  <p><strong>Ejemplo:</strong> <code>format(20)</code> ‚Üí <code>"20"</code></p>
  <p>Esta funci√≥n es necesaria cuando necesitas que un n√∫mero sea interpretado como texto para concatenar cadenas.</p>

  <h2 id="caracteres">Caracteres para la barra de progreso</h2>
  <p>Necesitas dos caracteres con estados diferentes:</p>
  <ul>
    <li><strong>Completado:</strong> ‚ñà (o ‚ñì)</li>
    <li><strong>Sin completar:</strong> ‚ñë</li>
  </ul>

  <h2 id="formula-completa">Construcci√≥n de la f√≥rmula completa</h2>
  <p>Con los elementos configurados (dos bases de datos relacionadas, propiedad Rollup con porcentaje llamada "Completadas", y caracteres elegidos), la f√≥rmula es:</p>
  <code>(prop("Completadas") &gt;= 1) ? "‚úÖ" : (slice("‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì", 0, round(prop("Completadas") * 10)) + slice("‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë", 0, round((1 - prop("Completadas")) * 10)) + " " + if(prop("Completadas") == 0, "0", format(round(prop("Completadas") * 100))) + "%")</code>

  <h2 id="desglose">Desglose de la f√≥rmula</h2>

  <h3>Si el porcentaje es 100% ‚Üí check (‚úÖ)</h3>
  <p>El condicional inicial verifica si "Completadas" es mayor o igual a 1 (equivalente al 100%). Si se cumple, muestra un check.</p>

  <h3>Si el porcentaje es menor al 100% ‚Üí barra de progreso</h3>

  <p><strong>Parte rellena:</strong></p>
  <p><code>slice("‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì", 0, round(prop("Completadas") * 10))</code></p>
  <p>Utiliza <code>slice()</code> con el string de caracteres rellenos. El punto final es el resultado de multiplicar el porcentaje por 10 y redondearlo. Ejemplo: 80% ‚Üí 8 caracteres.</p>

  <p><strong>Parte vac√≠a:</strong></p>
  <p><code>slice("‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë", 0, round((1 - prop("Completadas")) * 10))</code></p>
  <p>Sigue la misma l√≥gica pero restando el porcentaje a 1 para extraer la parte no completada.</p>

  <p><strong>Mostrar el porcentaje en n√∫meros:</strong></p>
  <p>Un espacio separa la barra del porcentaje. Usa <code>if()</code> para mostrar "0" si no hay tareas completadas. Si hay progreso, multiplica por 100, redondea con <code>round()</code>, convierte a texto con <code>format()</code> y a√±ade el s√≠mbolo <code>%</code> al final.</p>
</LessonLayout>
