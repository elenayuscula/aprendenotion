---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import {
  COURSE_MODULES,
  isSingleLessonModule,
} from '../../lib/course-modules';

const allLessons = await getCollection('lessons');

// Conteo real de lecciones publicadas por módulo
function countLessons(slugs: string[]): number {
  return slugs.filter((s) => allLessons.some((l) => l.id === s)).length;
}
---

<BaseLayout
  title="Curso de Notion — Aprende Notion"
  description="Aprende Notion desde cero con lecciones prácticas organizadas por temas. Todo gratis."
>
  <div class="page-wrapper page-wrapper--wide">
    <!-- Curso hero -->
    <section class="blog-hero">
      <h1 class="blog-hero__title">Curso de Notion</h1>
      <p class="blog-hero__subtitle">
        Lecciones prácticas para dominar Notion, organizadas por temas. 100% gratis.
      </p>
    </section>

    <!-- Module cards grid -->
    <div class="curso-index-grid">
      {COURSE_MODULES.map((mod) => {
        const isSingle = isSingleLessonModule(mod);
        const href = isSingle
          ? `/curso/${mod.lessonSlugs[0]}`
          : `/curso/${mod.slug}`;
        const count = countLessons(mod.lessonSlugs);

        return (
          <a href={href} class="curso-module-card">
            <span class="curso-module-card__emoji" aria-hidden="true">
              {mod.emoji}
            </span>
            <h2 class="curso-module-card__title">{mod.title}</h2>
            <p class="curso-module-card__desc">{mod.description}</p>
            {count > 1 && (
              <span class="curso-module-card__count">
                {count} lecciones
              </span>
            )}
          </a>
        );
      })}
    </div>

    {allLessons.length === 0 && (
      <section class="curso-empty">
        <p>
          Las lecciones se están preparando. Vuelve pronto o suscríbete a la
          newsletter para que te avise cuando estén listas.
        </p>
      </section>
    )}
  </div>
</BaseLayout>

<style>
  .curso-empty {
    text-align: center;
    padding: var(--space-16) 0;
    color: var(--color-text-secondary, #6B6B6B);
  }
</style>
